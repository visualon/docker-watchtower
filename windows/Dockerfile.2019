# escape=`

# renovate: datasource=github-releases depName=watchtower lookupName=containrrr/watchtower
ARG WATCHTOWER_VERSION=v1.3.0

#=================
# build
#=================
FROM mcr.microsoft.com/windows/servercore:ltsc2019@sha256:6dfc9ed8c6048a7a45fba93fdfc0b5c4cf1215392e74dfa674003ccfb99061fa AS build

ARG WATCHTOWER_VERSION
RUN `
  mkdir tmp && mkdir c:\bin && cd tmp`
	&& curl -sSfLo file.zip https://github.com/containrrr/watchtower/releases/download/%WATCHTOWER_VERSION%/watchtower_windows_amd64.zip `
  && tar -C c:\bin -oxzf file.zip `
  && /bin/watchtower --help

#=================
# final
#=================
FROM mcr.microsoft.com/windows/nanoserver:1809-amd64@sha256:502ecb75e37ada29fa102f92437a0b55504290a715a607d83a2b371811b00d44

LABEL maintainer="Michael Kriese <michael.kriese@visualon.de>" `
    org.opencontainers.image.authors="Michael Kriese <michael.kriese@visualon.de>" `
    org.opencontainers.image.licenses="MIT" `
    org.opencontainers.image.source="https://github.com/visualon/docker-watchtower" `
    org.opencontainers.image.url="https://github.com/visualon/docker-watchtower"

ENTRYPOINT ["/bin/watchtower"]
    
ARG WATCHTOWER_VERSION
LABEL org.opencontainers.image.version="${WATCHTOWER_VERSION}"

COPY --from=build ["/bin", "/bin"]
